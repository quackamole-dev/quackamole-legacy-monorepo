{"version":3,"sources":["store/reducers/room.reducer.js","store/actionTypes.js","utils.js","store/reducers/localUser.reducer.js","store/reducers/peers.reducer.js","store/reducers/connections.reducer.js","store/reducers/remoteStreams.reducer.js","store/reducers/plugin.reducer.js","store/reducers/chat.reducer.js","store/reducers/index.js","store/index.js","store/actions/remoteStreams.actions.js","store/actions/room.actions.js","store/actions/localStream.actions.js","store/actions/connections.actions.js","store/actions/localUser.actions.js","components/Room/GenericMediaCard/AudioVisualizer.jsx","components/Room/GenericMediaCard/GenericMediaCard.jsx","components/RoomLobby/MediaPreview/MediaPreview.jsx","components/RoomLobby/RoomLobby.jsx","store/actions/plugin.actions.js","components/Room/RoomPluginContent/RoomPluginContent.jsx","components/Room/RoomMediaManager/RemoteMediaCard/RemoteMediaCard.jsx","components/Room/RoomMediaManager/RemoteMediaManager/RemoteMediaManager.jsx","components/Room/RoomMediaManager/RoomMediaManager.jsx","components/Room/RoomSidebarMenu/RoomSidebarMenu.jsx","components/Room/RoomSidebarChat/Chat/ChatMsg.jsx","components/Room/RoomSidebarChat/Chat/ChatStyle.jsx","components/Room/RoomSidebarChat/Chat/Chat.jsx","store/actions/chat.actions.js","components/Room/RoomSidebarChat/RoomSidebarChat.jsx","components/Room/RoomActionbar/RoomActionbar.jsx","components/Room/Room.jsx","constants.js","components/Home/BulletPoint/BulletPoint.jsx","components/Home/Home.jsx","style/theme/MainTheme.jsx","components/RoomCreateForm/RoomCreateForm.jsx","components/App/App.jsx","index.jsx"],"names":["roomReducer","produce","roomDraft","action","type","data","payload","room","error","visitedLobby","clearStreamTracks","stream","getTracks","console","forEach","track","stop","getPersistedData","key","dataJson","localStorage","getItem","JSON","parse","defaultMediaConstraints","audio","video","width","ideal","height","initialState","socket","metadata","mediaConstraints","mediaStream","micEnabled","camEnabled","loading","localUserReducer","localPeerDraft","oldMediaStream","id","constraints","enabled","peersReducer","peersDraft","socketId","peer","connectionsReducer","connectionsDraft","connection","remoteSocketId","remoteStreamsReducer","streamsDraft","streamWrapper","streamWrappers","current","Object","values","wrappedStream","pluginReducer","pluginDraft","plugin","url","name","iframe","chatReducer","messagesDraft","push","reducer","combineReducers","localUser","peers","connections","remoteStreams","chat","store","createStore","composeWithDevTools","applyMiddleware","thunk","addStream","dispatch","getState","removeStream","setCurrentRoomError","setVisitedLobby","roomExitCleanup","state","currentRoom","emit","disconnect","resetLocalUser","localStreamWrapper","a","conn","removeConnection","startLocalStream","log","stopLocalStream","actualConstraints","navigator","mediaDevices","getUserMedia","newStream","updateStreamForConnections","setMediaStreamConstraints","toggleMicrophoneEnabled","newEnabled","toggleCameraEnabled","close","initDataChannelListeners","dataChannel","onmessage","evt","textMessage","nickname","authorSocketId","text","window","postMessage","contentWindow","senderSocketId","onopen","onclose","initConnectionListeners","currentIteration","iceCandidates","timer","length","receiverSocketId","rawDelay","Math","pow","roundedDelay","round","setTimeout","onicecandidate","iceCandidate","candidate","maxIterations","ontrack","streams","onnegotiationneeded","oniceconnectionstatechange","iceConnectionState","restartIce","onsignalingstatechange","signalingState","localDescription","remoteDescription","ondatachannel","defaultDataChannel","channel","introduceYourself","connectWithPeer","initNewRTCPeerConnection","newConnection","sendNewOfferToConnection","sendDataToConnection","serializedData","stringify","send","RTCPeerConnection","iceServers","urls","iceCandidatePoolSize","createDataChannel","tracks","addTrack","getSenders","sender","removeTrack","createOffer","offer","setLocalDescription","description","initLocalUserSocketListeners","on","connectionState","setRemoteDescription","RTCSessionDescription","createAnswer","answer","addIceCandidate","setMetadata","dataStringified","setItem","persistData","useStyles","makeStyles","theme","visualizer","transition","AudioVisualizer","children","styles","classes","audioIndicatorRef","useRef","useEffect","handler","getAudioTracks","style","boxShadow","audioCtx","AudioContext","webkitAudioContext","analyser","createAnalyser","minDecibels","maxDecibels","smoothingTimeConstant","fftSize","bufferLength","frequencyBinCount","dataArray","Float32Array","createMediaStreamSource","connect","setInterval","getFloatTimeDomainData","sumOfSquares","i","avgPowerDecibels","log10","Infinity","clearInterval","className","ref","root","display","cardWrapper","position","flexFlow","justifyContent","alignItems","videoOffIcon","top","left","transform","media","objectFit","displayName","color","opacity","bottom","fontSize","userSelect","GenericMediaCard","muted","user","videoRef","srcObject","oncanplay","play","setVideoSrc","marginBottom","getVideoTracks","wrapper","textAlign","containerForm","maxWidth","formControl","select","useState","microphones","setMicrophones","cameras","setCameras","currentMicrophone","setCurrentMicrophone","currentCamera","setCurrentCamera","settingsOpen","setSettingsOpen","initListOfDevices","handleSaveSettings","audioTrack","audioDevice","find","d","label","videoTrack","videoDevice","enumerateDevices","devices","filter","device","kind","handleClickOpen","handleClose","newConstraints","deviceId","onClick","disableBackdropClick","disableEscapeKeyDown","open","onClose","setVideoIcon","setAudioIcon","htmlFor","value","onChange","selectedLabel","target","selectedDevice","input","map","mic","groupId","cam","containerStyle","paddingTop","titleStyle","padding","fontWeight","backgroundColor","nicknameStyle","margin","textfieldLink","marginRight","marginLeft","nextButton","alignbutton","marginTop","roomError","history","match","newNickname","setNewNickname","params","roomId","link","setLink","handleJoin","e","bgcolor","paddingLeft","to","textDecoration","container","item","xs","md","lg","flexDirection","borderRadius","variant","required","onKeyPress","autoFocus","size","message","setPlugin","pluginMessageActions","peerId","iframeRef","handleMessage","startsWith","handlePluginMessage","addEventListener","removeEventListener","flexGrow","src","border","title","ownProps","remoteStreamWrapper","remoteStream","remoteNickname","roomMediaManager","borderLeft","localStream","localPeerMetadata","minWidth","list","menuIcon","plugins","setOpen","toggleDrawer","event","handleSelectPlugin","index","currentTarget","dataset","anchor","role","button","data-index","primary","ChatMsg","withStyles","palette","spacing","radius","rightBgColor","main","avatar","leftRow","rightRow","msg","wordBreak","fontFamily","borderTopRightRadius","borderBottomRightRadius","grey","right","borderTopLeftRadius","borderBottomLeftRadius","common","white","leftFirst","leftLast","rightFirst","rightLast","props","messages","side","GridContainerProps","GridItemProps","AvatarProps","getTypographyProps","justify","cx","TypographyProps","align","defaultProps","chatFeed","maxHeight","overflow","chatInput","chatInputTextfield","zIndex","chatInputSendBtn","cursor","chatData","newMessage","setNewMessage","feedRef","scrollTop","scrollHeight","preventDefault","replace","chatMessages","multiline","rowsMax","shiftKey","concat","RoomSidebarChat","_","borderTop","localPeerLoading","password","err","joinedUsers","io","process","transports","secure","location","protocol","query","object","entries","join","smallScreenContainer","alignTitle","customizeTitle","customizeIcon","customizeText","paddingRight","BulletPoint","icon","smallScreen","useMediaQuery","content","image","alt","header","textTransform","box","smallScreenBox","titleContainer","buttonStyle","outline","mainImg","smallScreenMainImg","bulletPoints","smallScreenBulletPoints","Home","aria-label","gutterBottom","createMuiTheme","secondary","borderColor","textfield","alignButton","btnCreateWrapper","btnCreate","fabProgress","btnCreateProgress","paper","copyLink","subtitle","RoomCreateForm","setName","setRoomId","setLoading","setError","useHistory","handleChangeTexfield","handleKeyPress","createRoom","maxUsers","Error","fetch","method","body","headers","res","status","json","origin","createRoomJSX","disabled","CircularProgress","shareRoomJSX","myButton","clipboard","writeText","App","ThemeProvider","exact","path","component","RoomLobby","Room","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4c7aab64.chunk.js","sourcesContent":["import {SET_CURRENT_ROOM, SET_CURRENT_ROOM_ERROR, SET_VISITED_LOBBY} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {\r\n    // id: 'dummy-room-id',\r\n    // name: 'Dummy Room',\r\n  },\r\n  visitedLobby: false,\r\n  error: null\r\n};\r\n\r\nconst roomReducer = produce((roomDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_CURRENT_ROOM: {\r\n      roomDraft.data = action.payload.room;\r\n      roomDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_VISITED_LOBBY: {\r\n      roomDraft.visitedLobby = action.payload.visitedLobby;\r\n      return;\r\n    }\r\n    case SET_CURRENT_ROOM_ERROR: {\r\n      roomDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default roomReducer;\r\n","export const ADD_PEER = 'ADD_PEER';\r\nexport const REMOVE_PEER = 'REMOVE_PEER';\r\nexport const SET_PEERS_ERROR = 'SET_PEERS_ERROR';\r\n\r\nexport const ADD_CONNECTION = 'ADD_CONNECTION';\r\nexport const REMOVE_CONNECTION = 'REMOVE_CONNECTION';\r\nexport const SET_CONNECTIONS_ERROR = 'SET_CONNECTIONS_ERROR';\r\n\r\nexport const ADD_STREAM = 'ADD_STREAM';\r\nexport const REMOVE_STREAM = 'REMOVE_STREAM';\r\nexport const SET_STREAMS_ERROR = 'SET_STREAM_ERROR';\r\nexport const CLEAR_ALL_STREAMS = 'CLEAR_ALL_STREAMS';\r\n\r\nexport const SET_CURRENT_ROOM = 'SET_CURRENT_ROOM';\r\nexport const SET_VISITED_LOBBY = 'SET_VISITED_LOBBY';\r\nexport const SET_CURRENT_ROOM_ERROR = 'SET_CURRENT_ROOM_ERROR';\r\n\r\nexport const SET_LOCAL_USER_LOADING = 'SET_LOCAL_USER_LOADING';\r\nexport const INIT_LOCAL_USER_SOCKET = 'INIT_LOCAL_USER_SOCKET';\r\nexport const INIT_LOCAL_USER_PEER = 'INIT_LOCAL_USER_PEER';\r\nexport const SET_LOCAL_USER_METADATA = 'SET_LOCAL_USER_METADATA';\r\nexport const SET_LOCAL_USER_MEDIA_STREAM = 'SET_LOCAL_USER_MEDIA_STREAM';\r\nexport const SET_LOCAL_USER_MEDIA_CONSTRAINTS = 'SET_LOCAL_USER_MEDIA_CONSTRAINTS';\r\nexport const SET_LOCAL_USER_MICROPHONE_ENABLED = 'SET_LOCAL_USER_MICROPHONE_ENABLED';\r\nexport const SET_LOCAL_USER_CAMERA_ENABLED = 'SET_LOCAL_USER_CAMERA_ENABLED';\r\nexport const SET_LOCAL_USER_ERROR = 'SET_LOCAL_USER_ERROR';\r\nexport const RESET_LOCAL_USER = 'RESET_LOCAL_USER';\r\n\r\nexport const SET_PLUGIN = 'SET_PLUGIN';\r\nexport const SET_PLUGIN_ERROR = 'SET_PLUGIN_ERROR';\r\n\r\nexport const ADD_NEW_MESSAGE = 'ADD_NEW_MESSAGE';\r\n","// The place to put all helper methods that do not necessarily belong to a specific component\r\n// Once this file gets too crowded, create an utils folder and start seperating the exported helper methods\r\n\r\n// import {useEffect, useRef, useState} from \"react\";\r\nimport ipRegex from 'ip-regex';\r\n\r\n/**\r\n * Transforms a javascript object into a query string.\r\n * @param object The source object. Example: {a: 5, b: 10}\r\n * @returns {string} The resulting query string. Example 'a=5&b=10'\r\n */\r\nexport const serializeQueryString = object => {\r\n  return Object.entries(object).map(([key, value]) => `${key}=${value}`).join('&');\r\n};\r\n\r\n/**\r\n * Set the src of a html5 <video> element and start playing\r\n * @param videoRef The reference to the video element\r\n * @param stream The stream that should be played by the referenced video element\r\n * @param muted Whether or not the audio of the stream should be muted\r\n */\r\nexport const setVideoSrc = (videoRef, stream, muted = true) => {\r\n  if (videoRef.current && stream) {\r\n    videoRef.current.srcObject = stream;\r\n    videoRef.current.oncanplay = () => { // FIXME rarely does not get fired for all peers, so remote stream can appear white\r\n      if (videoRef.current) {\r\n        videoRef.current.play();\r\n        videoRef.current.muted = muted;\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\nexport const clearStreamTracks = stream => {\r\n  if (stream) {\r\n    if (!stream.getTracks) {\r\n      console.error('something wrong with the stream:', stream);\r\n      return;\r\n    }\r\n\r\n    stream.getTracks().forEach(track => track.stop());\r\n  }\r\n};\r\n\r\nexport const getPersistedData = (key) => {\r\n  const dataJson = localStorage.getItem(key);\r\n  return dataJson ? JSON.parse(dataJson) : {};\r\n};\r\n\r\nexport const persistData = (key, data) => {\r\n  const dataStringified = JSON.stringify(data);\r\n  localStorage.setItem(key, dataStringified);\r\n};\r\n\r\nexport const isIpAddress = (testedString) => {\r\n  return ipRegex().test(testedString);\r\n};\r\n","import {INIT_LOCAL_USER_SOCKET, RESET_LOCAL_USER, SET_LOCAL_USER_ERROR, SET_LOCAL_USER_LOADING, SET_LOCAL_USER_METADATA, SET_LOCAL_USER_MEDIA_STREAM, SET_LOCAL_USER_MEDIA_CONSTRAINTS, SET_LOCAL_USER_CAMERA_ENABLED, SET_LOCAL_USER_MICROPHONE_ENABLED} from '../actionTypes';\r\nimport {clearStreamTracks, getPersistedData} from '../../utils';\r\nimport produce from 'immer';\r\n\r\nconst defaultMediaConstraints = {\r\n  audio: {},\r\n  video: {\r\n    // frameRate: { ideal: 20, max: 25 }, // FIXME check supported constraints first to prevent errors\r\n    width: { ideal: 128 },\r\n    height: { ideal: 72 }\r\n  }\r\n};\r\n\r\nconst initialState = {\r\n  socket: null,\r\n  metadata: getPersistedData('metadata'),\r\n  mediaConstraints: defaultMediaConstraints,\r\n  mediaStream: null,\r\n  micEnabled: true,\r\n  camEnabled: true,\r\n  loading: false,\r\n  error: null\r\n};\r\n\r\nconst localUserReducer = produce((localPeerDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_LOCAL_USER_LOADING: {\r\n      localPeerDraft.loading = action.payload.loading;\r\n      return;\r\n    }\r\n    case INIT_LOCAL_USER_SOCKET: {\r\n      localPeerDraft.socket = action.payload.socket;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_METADATA: {\r\n      localPeerDraft.metadata = action.payload.metadata;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MEDIA_STREAM: {\r\n      const oldMediaStream = localPeerDraft.mediaStream;\r\n\r\n      localPeerDraft.mediaStream = action.payload.mediaStream;\r\n      localPeerDraft.error = null;\r\n\r\n      // Cleanup old stream. Without this, webcam light can stay on unintentionally due to unreliable garbage collection\r\n      if (oldMediaStream) {\r\n        if (action.payload.mediaStream && action.payload.mediaStream.stream.id !== oldMediaStream.stream.id) {\r\n          clearStreamTracks(oldMediaStream.stream);\r\n        } else if (!action.payload.mediaStream) {\r\n          clearStreamTracks(oldMediaStream.stream);\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MEDIA_CONSTRAINTS: {\r\n      localPeerDraft.mediaConstraints = action.payload.constraints;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MICROPHONE_ENABLED: {\r\n      localPeerDraft.micEnabled = action.payload.enabled;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_CAMERA_ENABLED: {\r\n      localPeerDraft.camEnabled = action.payload.enabled;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_ERROR: {\r\n      localPeerDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    case RESET_LOCAL_USER: {\r\n      localPeerDraft.socket = null;\r\n      localPeerDraft.metadata = getPersistedData('metadata');\r\n      localPeerDraft.mediaConstraints = defaultMediaConstraints;\r\n      localPeerDraft.mediaStream = null;\r\n      localPeerDraft.micEnabled = true;\r\n      localPeerDraft.camEnabled = true;\r\n      localPeerDraft.loading = false;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default localUserReducer;\r\n","import {ADD_PEER, REMOVE_PEER, SET_PEERS_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {\r\n    // 'd7f7saim3': {nickname: 'Andi'},\r\n    // '32mfdnmio': {nickname: 'Jimmy'}\r\n  },\r\n  error: null\r\n};\r\n\r\nconst peersReducer = produce((peersDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_PEER: {\r\n      const { socketId, metadata } = action.payload;\r\n      peersDraft.data[socketId] = { metadata };\r\n      peersDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_PEER: {\r\n      const peer = action.payload.peer;\r\n      delete peersDraft.data[peer.id];\r\n      peersDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_PEERS_ERROR: {\r\n      peersDraft.error = action.payload.error;\r\n      return;\r\n\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default peersReducer;\r\n","import {ADD_CONNECTION, REMOVE_CONNECTION, SET_CONNECTIONS_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {},\r\n  error: null\r\n};\r\n\r\nconst connectionsReducer = produce((connectionsDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_CONNECTION: {\r\n      const connection = action.payload.connection;\r\n      connectionsDraft.data[connection.remoteSocketId] = connection;\r\n      connectionsDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_CONNECTION: {\r\n      const connection = action.payload.connection;\r\n      delete connectionsDraft.data[connection.remoteSocketId];\r\n      connectionsDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_CONNECTIONS_ERROR: {\r\n      connectionsDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default connectionsReducer;\r\n","import {ADD_STREAM, CLEAR_ALL_STREAMS, REMOVE_STREAM, SET_STREAMS_ERROR} from '../actionTypes';\r\nimport {clearStreamTracks} from '../../utils';\r\nimport produce, {current} from 'immer';\r\n\r\nconst initialState = {\r\n  data: {},\r\n  error: null\r\n};\r\n\r\nconst remoteStreamsReducer = produce((streamsDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_STREAM: {\r\n      const { socketId, stream } = action.payload;\r\n      streamsDraft.data[socketId] = { stream };\r\n      streamsDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_STREAM: {\r\n      const { socketId } = action.payload;\r\n      const streamWrapper = streamsDraft.data[socketId];\r\n      if (streamWrapper) {\r\n        clearStreamTracks(streamWrapper.stream);\r\n        delete streamsDraft.data[socketId];\r\n      }\r\n      return;\r\n    }\r\n    case SET_STREAMS_ERROR: {\r\n      streamsDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    case CLEAR_ALL_STREAMS: {\r\n      const streamWrappers = current(streamsDraft.data);\r\n      Object.values(streamWrappers).forEach(wrappedStream => clearStreamTracks(wrappedStream.stream));\r\n      streamsDraft.data = {};\r\n      streamsDraft.error = null;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default remoteStreamsReducer;\r\n","import {SET_PLUGIN, SET_PLUGIN_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\n// TODO there should be a plugins.reducer storing the plugin data of already fetched plugins (once they come from the backend)\r\n//  activePluginId should be stored in the room.reducer, as well as pluginIds that are shown in the room sidebar.\r\n//  plugin data can be fetched from the backend (or could already be included when fetching the room)\r\nconst initialState = {\r\n  // origin: 'null',\r\n  iframe: null,\r\n  url: '',\r\n  name: 'p2p-test-plugin',\r\n  error: null\r\n};\r\n\r\nconst pluginReducer = produce((pluginDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_PLUGIN: {\r\n      const { url, name, iframe } = action.payload.plugin;\r\n      pluginDraft.iframe = iframe;\r\n      pluginDraft.url = url;\r\n      pluginDraft.name = name;\r\n      pluginDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_PLUGIN_ERROR: {\r\n      pluginDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default pluginReducer;\r\n","import {ADD_NEW_MESSAGE} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = [];\r\n\r\nconst chatReducer = produce((messagesDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_NEW_MESSAGE: {\r\n      messagesDraft.push(action.payload);  // FIXME should be action.payload.message\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default chatReducer;\r\n","import {combineReducers} from 'redux';\r\nimport roomReducer from './room.reducer';\r\nimport localUserReducer from './localUser.reducer';\r\nimport peersReducer from './peers.reducer';\r\nimport connectionsReducer from './connections.reducer';\r\nimport remoteStreamsReducer from './remoteStreams.reducer';\r\nimport pluginReducer from './plugin.reducer';\r\nimport chatReducer from './chat.reducer';\r\n\r\nconst reducer = combineReducers({\r\n  room: roomReducer,\r\n  localUser: localUserReducer,\r\n  peers: peersReducer,\r\n  connections: connectionsReducer,\r\n  remoteStreams: remoteStreamsReducer,\r\n  plugin: pluginReducer,\r\n  chat: chatReducer\r\n});\r\n\r\nexport default reducer;\r\n","import {applyMiddleware, createStore} from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport {composeWithDevTools} from 'redux-devtools-extension';\r\nimport reducer from './reducers';\r\n\r\nconst store = createStore(reducer, composeWithDevTools(applyMiddleware(thunk)));\r\n\r\nexport default store;\r\n","import {ADD_STREAM, CLEAR_ALL_STREAMS, REMOVE_STREAM} from '../actionTypes';\r\n\r\nexport const addStream = (socketId, stream) => (dispatch, getState) => { // TODO no need for a thunk, rename to setStream & SET_STREAM\r\n  if (stream) {\r\n    dispatch({ type: ADD_STREAM, payload: { socketId, stream } });\r\n  }\r\n};\r\n\r\nexport const removeStream = (socketId) => (dispatch, getState) => { // TODO no need for a thunk\r\n  if (socketId) {\r\n    dispatch({ type: REMOVE_STREAM, payload: { socketId } });\r\n  }\r\n};\r\n\r\nexport const clearAllStreams = () => async (dispatch, getState) => {\r\n  dispatch({ type: CLEAR_ALL_STREAMS });\r\n};\r\n","import {SET_CURRENT_ROOM, SET_CURRENT_ROOM_ERROR, SET_VISITED_LOBBY} from '../actionTypes';\r\nimport {clearAllStreams} from './remoteStreams.actions';\r\nimport {resetLocalUser} from './localUser.actions';\r\nimport {removeConnection} from './connections.actions';\r\n\r\nexport const setCurrentRoom = room => ({\r\n  type: SET_CURRENT_ROOM,\r\n  payload: { room }\r\n});\r\n\r\nexport const setCurrentRoomError = error => ({\r\n  type: SET_CURRENT_ROOM_ERROR,\r\n  payload: { error }\r\n});\r\n\r\nexport const setVisitedLobby = visitedLobby => ({\r\n  type: SET_VISITED_LOBBY,\r\n  payload: { visitedLobby }\r\n});\r\n\r\nexport const roomExitCleanup = () => (dispatch, getState) => {\r\n  const state = getState();\r\n\r\n  dispatch(setVisitedLobby(false));\r\n\r\n  const socket = state.localUser.socket;\r\n  if (socket) {\r\n    // disconnect from socketIO server\r\n    const currentRoom = state.room.data;\r\n    if (currentRoom.id) {\r\n      socket.emit('leave', currentRoom.id);\r\n      dispatch(setCurrentRoom({}));\r\n    }\r\n    socket.disconnect();\r\n    dispatch(resetLocalUser());\r\n\r\n    // clear local media stream\r\n    const localStreamWrapper = state.localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      localStreamWrapper.stream.getTracks().forEach(track => track.stop());\r\n    }\r\n    dispatch(clearAllStreams());\r\n  }\r\n\r\n  // close all RTCPeerConnections\r\n  const connections = state.connections.data;\r\n  if (connections) {\r\n    Object.values(connections).forEach(conn => dispatch(removeConnection(conn)));\r\n  }\r\n};\r\n","import {addStream} from './remoteStreams.actions';\r\nimport {clearStreamTracks} from '../../utils';\r\nimport {SET_LOCAL_USER_CAMERA_ENABLED, SET_LOCAL_USER_MEDIA_CONSTRAINTS, SET_LOCAL_USER_MEDIA_STREAM, SET_LOCAL_USER_MICROPHONE_ENABLED} from '../actionTypes';\r\nimport {updateStreamForConnections} from './connections.actions';\r\n\r\nexport const startLocalStream = () => async (dispatch, getState) => {\r\n  console.log('startLocalStream dispatched');\r\n  const { mediaConstraints, micEnabled, camEnabled } = getState().localUser;\r\n\r\n  if (!micEnabled && !camEnabled) {\r\n    dispatch(stopLocalStream());\r\n    return;\r\n  }\r\n\r\n  const actualConstraints = { ...mediaConstraints };\r\n  actualConstraints.audio = micEnabled ? actualConstraints.audio : false;\r\n  actualConstraints.video = camEnabled ? actualConstraints.video : false;\r\n\r\n  try {\r\n    const newStream = await navigator.mediaDevices.getUserMedia(actualConstraints);\r\n    await dispatch(updateStreamForConnections(newStream));\r\n    await dispatch({ type: SET_LOCAL_USER_MEDIA_STREAM, payload: { mediaStream: { stream: newStream } } });\r\n    return newStream;\r\n  } catch (error) {\r\n    console.error('local stream couldn\\'t be started', error);\r\n  }\r\n};\r\n\r\nexport const stopLocalStream = () => async (dispatch, getState) => {\r\n  const { mediaStream } = getState().localUser;\r\n\r\n  if (mediaStream) {\r\n    clearStreamTracks(mediaStream.stream);\r\n    dispatch({ type: SET_LOCAL_USER_MEDIA_STREAM, payload: { mediaStream: false } });\r\n  }\r\n};\r\n\r\nexport const toggleLocalAudio = () => (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  if (socket) {\r\n    const localStreamWrapper = getState().localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      const localStream = localStreamWrapper.stream;\r\n      localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;\r\n      dispatch(addStream(socket.id, localStream));\r\n    }\r\n  }\r\n};\r\n\r\nexport const toggleLocalVideo = () => (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  if (socket) {\r\n    const localStreamWrapper = getState().localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      const localStream = localStreamWrapper.stream;\r\n      localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled;\r\n      dispatch(addStream(socket.id, localStream));\r\n    }\r\n  }\r\n};\r\n\r\nexport const setMediaStreamConstraints = (constraints) => async (dispatch, getState) => {\r\n  await dispatch({ type: SET_LOCAL_USER_MEDIA_CONSTRAINTS, payload: { constraints } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n\r\nexport const toggleMicrophoneEnabled = () => (dispatch, getState) => {\r\n  const newEnabled = !getState().localUser.micEnabled;\r\n  dispatch({ type: SET_LOCAL_USER_MICROPHONE_ENABLED, payload: { enabled: newEnabled } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper || newEnabled) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n\r\nexport const toggleCameraEnabled = () => (dispatch, getState) => {\r\n  const newEnabled = !getState().localUser.camEnabled;\r\n  dispatch({ type: SET_LOCAL_USER_CAMERA_ENABLED, payload: { enabled: newEnabled } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper || newEnabled) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n","import {ADD_CONNECTION, ADD_NEW_MESSAGE, ADD_PEER, REMOVE_CONNECTION, SET_CURRENT_ROOM} from '../actionTypes';\r\nimport {addStream, removeStream} from './remoteStreams.actions';\r\nimport {setCurrentRoomError} from './room.actions';\r\nimport {startLocalStream} from './localStream.actions';\r\n\r\nexport const removeConnection = connection => async (dispatch, getState) => {\r\n  if (connection && connection.remoteSocketId && connection.socketId) {\r\n\r\n    const stream = getState().remoteStreams.data[connection.remoteSocketId];\r\n    if (stream) {\r\n      await dispatch(removeStream(connection.remoteSocketId));\r\n    }\r\n\r\n    connection.close();\r\n    await dispatch({ type: REMOVE_CONNECTION, payload: { connection } });\r\n  }\r\n};\r\n\r\nexport const initDataChannelListeners = dataChannel => (dispatch, getState) => {\r\n  if (dataChannel) {\r\n    console.log(`Initializing data channel listeners...`);\r\n    dataChannel.onmessage = evt => {\r\n      const data = JSON.parse(evt.data);\r\n      const type = data.type;\r\n\r\n      if (data.textMessage) {\r\n        dispatch({ type: ADD_NEW_MESSAGE, payload: data.textMessage });\r\n\r\n        const metadata = getState().localUser.metadata;\r\n        console.log(\r\n          `%c MESSAGE - ${metadata.nickname || data.textMessage.authorSocketId}: \"${data.textMessage.text}\"`,\r\n          'background: black; color: white; padding: 1rem; border: 1px solid white; border-radius: 5px;'\r\n        );\r\n      }\r\n\r\n      if (type === 'PLUGIN_DATA') {\r\n        window.postMessage(data.payload, '*');\r\n        const iframe = getState().plugin.iframe;\r\n        if (iframe) {\r\n          iframe.contentWindow.postMessage(data, '*');\r\n        }\r\n      }\r\n\r\n      if (type === 'PEER_INTRODUCTION') {\r\n        console.log('Connected peer is introducing himself to you:', data.payload);\r\n        const { senderSocketId, metadata } = data.payload;\r\n        dispatch({ type: ADD_PEER, payload: { metadata: metadata, socketId: senderSocketId } });\r\n      }\r\n    };\r\n\r\n    dataChannel.onopen = () => {\r\n      console.log('datachannel open...');\r\n    };\r\n\r\n    dataChannel.onclose = () => {\r\n      console.log('datachannel close');\r\n    };\r\n  }\r\n};\r\n\r\nexport const initConnectionListeners = connection => (dispatch, getState) => {\r\n  if (connection && connection.socketId) {\r\n    console.log(`Initializing RTCPeerConnection listeners...`);\r\n    const delayMultiplier = 1.5;\r\n    const baseDelay = 450;\r\n    const maxIterations = 9;\r\n    let currentIteration = 0;\r\n    let iceCandidates = [];\r\n\r\n    // emits ice-candidates with an increasing delay until the onicecandidate null event\r\n    // Most of the candidates trickle in within the first 0-2seconds but the null event can happen much later\r\n    // The goal is to send ice-candidates out quickly with the least amount of signaling until the null event\r\n    // High likelihood to be changed/simplified as time goes by...\r\n    const timer = () => {\r\n      if (iceCandidates.length) {\r\n        const { socket } = getState().localUser;\r\n        console.log(`Sending ${iceCandidates.length}x ICE CANDIDATES to peer...`);\r\n        socket.emit('signaling', { receiverSocketId: connection.remoteSocketId, iceCandidates: iceCandidates });\r\n        iceCandidates = [];\r\n      }\r\n\r\n      if (currentIteration <= maxIterations) {\r\n        const rawDelay = baseDelay * Math.pow(delayMultiplier, currentIteration);\r\n        const roundedDelay = Math.round(rawDelay / 100 * 2) * 100 / 2;\r\n\r\n        setTimeout(timer, Math.round(roundedDelay));\r\n        currentIteration++;\r\n      }\r\n    };\r\n    timer();\r\n\r\n    connection.onicecandidate = (evt) => {\r\n\r\n      const iceCandidate = evt.candidate;\r\n      if (iceCandidate) {\r\n        iceCandidates.push(iceCandidate);\r\n      } else {\r\n        console.log('no more ICE');\r\n        currentIteration = maxIterations + 1;\r\n        timer();\r\n      }\r\n    };\r\n\r\n    connection.ontrack = ({ track, streams }) => {\r\n      if (streams && streams[0]) {\r\n        console.log(`A remote stream track was received from ${connection.remoteSocketId}...`);\r\n        dispatch(addStream(connection.remoteSocketId, streams[0]));\r\n      } else {\r\n        console.error('ontrack - this should not happen... streams[0] is empty!');\r\n      }\r\n    };\r\n\r\n    connection.onnegotiationneeded = async evt => {\r\n      console.log(`(onnegotiationneeded triggered for connection with \"${connection.remoteSocketId}\"...)`);\r\n    };\r\n\r\n    connection.oniceconnectionstatechange = () => {\r\n      if (connection.iceConnectionState === 'failed') {\r\n        console.error('oniceconnectionstatechange - restarting ICE');\r\n        connection.restartIce();\r\n      }\r\n    };\r\n\r\n    connection.onsignalingstatechange = evt => {\r\n      if (connection.signalingState === 'stable' && connection.localDescription && connection.remoteDescription) {\r\n        console.log('CONNECTION ESTABLISHED!! signaling state:', connection.signalingState);\r\n      }\r\n    };\r\n\r\n    connection.ondatachannel = async evt => {\r\n      console.log('Remote peer opened a data channel with you...');\r\n      connection.defaultDataChannel = evt.channel;\r\n      await dispatch(initDataChannelListeners(connection.defaultDataChannel));\r\n      dispatch(introduceYourself(connection.defaultDataChannel));\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Establishes the initial connection between two peers.\r\n * @param remoteSocketId - The socketId of the peer you want to connect with\r\n */\r\nexport const connectWithPeer = remoteSocketId => async (dispatch, getState) => {\r\n  const { socket } = getState().localUser;\r\n  if (remoteSocketId === socket.id) return;\r\n\r\n  const existingConnection = getState().connections.data[remoteSocketId];\r\n\r\n  if (existingConnection) {\r\n    console.error(`You already established a connection with ${remoteSocketId}`);\r\n  } else {\r\n    console.log(`Preparing to connect with \"${remoteSocketId}\" ...`);\r\n    const newConnection = await dispatch(initNewRTCPeerConnection(remoteSocketId));\r\n    await dispatch(sendNewOfferToConnection(newConnection));\r\n    return newConnection;\r\n  }\r\n};\r\n\r\nexport const sendDataToConnection = (dataChannel, data) => async (dispatch, getState) => {\r\n  if (dataChannel) {\r\n    const serializedData = JSON.stringify(data);\r\n    dataChannel.send(serializedData);\r\n  }\r\n};\r\n\r\nexport const joinRoom = (roomId, password) => async (dispatch, getState) => { // TODO move to room actions\r\n  const { socket } = getState().localUser;\r\n\r\n  if (socket) {\r\n    socket.emit('join', { roomId, password, socketId: socket.id },\r\n      // callback: the joining user himself is responsible to establish connections with other users\r\n      async (err, data) => {\r\n        if (!err) {\r\n          await dispatch(startLocalStream());\r\n          await dispatch({ type: SET_CURRENT_ROOM, payload: { room: data.room } });\r\n          data.room.joinedUsers.forEach((remoteSocketId) => dispatch(connectWithPeer(remoteSocketId)));\r\n          console.log(`There are ${data.room.joinedUsers.length}x joinedUsers`);\r\n        } else {\r\n          dispatch(setCurrentRoomError(err));\r\n        }\r\n      });\r\n  }\r\n};\r\n\r\nexport const introduceYourself = (dataChannel) => async (dispatch, getState) => {\r\n  const { socket, metadata } = getState().localUser;\r\n\r\n  if (socket && metadata) {\r\n    dispatch(sendDataToConnection(dataChannel, { type: 'PEER_INTRODUCTION', payload: { senderSocketId: socket.id, metadata: metadata } }));\r\n  } else {\r\n    console.error('socket and/or metadata not available!');\r\n  }\r\n};\r\n\r\nexport const initNewRTCPeerConnection = (remoteSocketId) => async (dispatch, getState) => {\r\n  console.log(`Creating new RTCPeerConnection with \"${remoteSocketId}\" ...`);\r\n  const { socket } = getState().localUser;\r\n\r\n  const configuration = {\r\n    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }],\r\n    iceCandidatePoolSize: 1\r\n  };\r\n\r\n  const newConnection = new RTCPeerConnection(configuration);\r\n  newConnection.socketId = socket.id;\r\n  newConnection.remoteSocketId = remoteSocketId;\r\n  newConnection.defaultDataChannel = newConnection.createDataChannel('default');\r\n\r\n  await dispatch(initDataChannelListeners(newConnection.defaultDataChannel));\r\n  await dispatch(initConnectionListeners(newConnection));\r\n\r\n  const localStreamWrapper = await getState().localUser.mediaStream;\r\n  if (localStreamWrapper) {\r\n    const tracks = localStreamWrapper.stream.getTracks();\r\n    console.log(`Adding ${tracks.length}x stream tracks to the new RTCPeerConnection with \"${remoteSocketId}\"...`);\r\n    for (const track of tracks) {\r\n      await newConnection.addTrack(track, localStreamWrapper.stream);\r\n    }\r\n  }\r\n\r\n  await dispatch({ type: ADD_CONNECTION, payload: { connection: newConnection } });\r\n  return newConnection;\r\n};\r\n\r\nexport const updateStreamForConnections = (newStream) => async (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n\r\n  for (const connection of connections) {\r\n    console.log(`Updating localStream for RTCPeerConnection with \"${connection.remoteSocketId}\"...`);\r\n\r\n    for (const sender of connection.getSenders()) {\r\n      await connection.removeTrack(sender);\r\n    }\r\n\r\n    if (newStream) {\r\n      for (const track of newStream.getTracks()) {\r\n        await connection.addTrack(track, newStream);\r\n      }\r\n    }\r\n\r\n    dispatch(sendNewOfferToConnection(connection));\r\n  }\r\n};\r\n\r\nexport const sendNewOfferToConnection = (connection) => async (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  const offer = await connection.createOffer();\r\n  await connection.setLocalDescription(offer);\r\n  console.log('Sending offer to remote peer...');\r\n  socket.emit('signaling', { receiverSocketId: connection.remoteSocketId, description: connection.localDescription });\r\n};\r\n","import {INIT_LOCAL_USER_SOCKET, RESET_LOCAL_USER, SET_LOCAL_USER_LOADING, SET_LOCAL_USER_METADATA} from '../actionTypes';\r\nimport io from 'socket.io-client';\r\nimport {getPersistedData, persistData, serializeQueryString} from '../../utils';\r\nimport {initNewRTCPeerConnection, removeConnection} from './connections.actions';\r\nimport {setCurrentRoomError} from './room.actions';\r\nimport {BACKEND_URL} from '../../constants';\r\n\r\nexport const resetLocalUser = () => ({ type: RESET_LOCAL_USER });\r\n\r\n/**\r\n * Init the socket.io client. Once socket is ready, init the peerJS Peer and store them in the store.\r\n */\r\nexport const initLocalUser = () => async (dispatch, getState) => {\r\n  const metadata = getPersistedData('metadata');\r\n\r\n  if (!getState().localUser.loading) {\r\n    if (!metadata.nickname || !metadata.nickname.length) {\r\n      dispatch(setCurrentRoomError({ error: { name: 'RoomError', message: 'Please enter a nickname before joining the room.' } }));\r\n    } else {\r\n      dispatch({ type: SET_LOCAL_USER_LOADING, payload: { loading: true } });\r\n      const socket = io(BACKEND_URL, {\r\n        transports: ['websocket'],\r\n        secure: window.location.protocol === 'https',\r\n        query: serializeQueryString(metadata)\r\n      });\r\n\r\n      dispatch(initLocalUserSocketListeners(socket));\r\n    }\r\n  }\r\n};\r\n\r\nconst initLocalUserSocketListeners = (socket) => async (dispatch, getState) => {\r\n  socket.on('ready', (socketId) => {\r\n    dispatch({ type: INIT_LOCAL_USER_SOCKET, payload: { socket } });\r\n\r\n    socket.on('user-leave', (socketId) => {\r\n      const connection = getState().connections.data[socketId];\r\n      if (connection) {\r\n        dispatch(removeConnection(connection));\r\n      }\r\n    });\r\n\r\n    socket.on('signaling', async ({ senderSocketId, description, iceCandidates }) => {\r\n      let connection = getState().connections.data[senderSocketId];\r\n      if (!connection) {\r\n        connection = await (dispatch(initNewRTCPeerConnection(senderSocketId)));\r\n      }\r\n\r\n      // RECEIVING OFFER\r\n      if (description && description.type === 'offer') {\r\n        console.log(`You received an ${connection.connectionState === 'new' ? 'INITIAL' : ''} OFFER from \"${senderSocketId}\"...`);\r\n\r\n        await connection.setRemoteDescription(new RTCSessionDescription(description));\r\n        const answer = await connection.createAnswer();\r\n        await connection.setLocalDescription(answer);\r\n        console.log('Sending answer to remote peer...');\r\n        socket.emit('signaling', { receiverSocketId: senderSocketId, description: answer });\r\n\r\n        // RECEIVING ANSWER\r\n      } else if (description && description.type) {\r\n        console.log(`You received an ANSWER from \"${senderSocketId}\"...`);\r\n        if (!connection) {\r\n          console.error('No offer was ever made for the received answer. Investigate!');\r\n        }\r\n        await connection.setRemoteDescription(new RTCSessionDescription(description));\r\n\r\n        // RECEIVING ICE CANDIDATES\r\n      } else if (iceCandidates) {\r\n        console.log(`You received ICE CANDIDATES from \"${senderSocketId}\"...`);\r\n        for (const candidate of iceCandidates) {\r\n          await connection.addIceCandidate(candidate);\r\n        }\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const setMetadata = (metadata) => (dispatch, getState) => {\r\n  persistData('metadata', metadata);\r\n  dispatch({ type: SET_LOCAL_USER_METADATA, payload: { metadata } });\r\n};\r\n","import React, {useEffect, useRef} from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Card} from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  visualizer: {\r\n    transition: 'box-shadow 0.2s'\r\n  }\r\n}));\r\n\r\nconst AudioVisualizer = ({ stream, children, styles }) => {\r\n  const classes = useStyles();\r\n  const audioIndicatorRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    let handler = null;\r\n    if (stream && audioIndicatorRef.current) {\r\n\r\n      if (!stream.getAudioTracks()[0]) {\r\n        audioIndicatorRef.current.style.boxShadow = 'none';\r\n        return;\r\n      }\r\n\r\n      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();\r\n      const analyser = audioCtx.createAnalyser();\r\n      analyser.minDecibels = -90;\r\n      analyser.maxDecibels = -10;\r\n      analyser.smoothingTimeConstant = 0.25;\r\n\r\n      analyser.fftSize = 512;\r\n      const bufferLength = analyser.frequencyBinCount;\r\n      const dataArray = new Float32Array(analyser.fftSize);\r\n\r\n      const source = audioCtx.createMediaStreamSource(stream);\r\n      source.connect(analyser);\r\n\r\n      const checkIfUserIsSpeaking = () => {\r\n        analyser.getFloatTimeDomainData(dataArray);\r\n\r\n        // Compute average power over the interval. Based on this: https://stackoverflow.com/a/44360729\r\n        let sumOfSquares = 0;\r\n        for (let i = 0; i < bufferLength; i++) {\r\n          sumOfSquares += dataArray[i] ** 2;\r\n        }\r\n        const avgPowerDecibels = 10 * Math.log10(sumOfSquares / bufferLength);\r\n\r\n        if (avgPowerDecibels === -Infinity) return;\r\n        // Add box shadow when speaking (attention: this is circumventing react rendering)\r\n        // FIXME not happy with how it looks yet. Experiment with different ways to visualize audio\r\n        if (avgPowerDecibels >= -40) {\r\n          audioIndicatorRef.current.style.boxShadow = `0px 0px 0px 2px rgb(46, 125, 50)`;\r\n        } else {\r\n          audioIndicatorRef.current.style.boxShadow = 'none';\r\n        }\r\n      };\r\n\r\n      if (!handler) {\r\n        handler = setInterval(checkIfUserIsSpeaking, 1000 / 15);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (handler) clearInterval(handler);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [stream, audioIndicatorRef]);\r\n\r\n  return (\r\n    <Card className={classes.visualizer} ref={audioIndicatorRef} style={styles}>\r\n      {children}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default AudioVisualizer;\r\n","import React, {useEffect, useRef} from 'react';\r\nimport {setVideoSrc} from '../../../utils';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Card, CircularProgress, Box} from '@material-ui/core';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\nimport AudioVisualizer from './AudioVisualizer';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex'\r\n  },\r\n  cardWrapper: {\r\n    position: 'relative',\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    width: '100%',\r\n    height: '130px'\r\n  },\r\n  videoOffIcon: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    transform: 'translate(-50%, -50%)'\r\n  },\r\n  media: {\r\n    width: '100%',\r\n    height: '100%',\r\n    objectFit: 'cover'\r\n  },\r\n  displayName: {\r\n    color: 'white',\r\n    opacity: '0.8',\r\n    position: 'absolute',\r\n    bottom: '5px',\r\n    left: '5px',\r\n    fontSize: '0.9rem',\r\n    userSelect: 'none'\r\n  }\r\n}));\r\n\r\nconst GenericMediaCard = ({ stream, muted = false, user }) => {\r\n  const classes = useStyles();\r\n  const videoRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    setVideoSrc(videoRef, stream, muted);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [stream]);\r\n\r\n  return (\r\n    <AudioVisualizer stream={stream} styles={{ marginBottom: '5px' }}>\r\n      <Card className={classes.cardWrapper}>\r\n        {stream\r\n          ? <video ref={videoRef} className={classes.media}/>\r\n          : <CircularProgress color=\"inherit\"/>\r\n        }\r\n        {stream && !stream.getVideoTracks()[0] && <VideocamOffIcon className={classes.videoOffIcon} color='primary' fontSize='large'/>}\r\n        {user && user.nickname && <Box className={classes.displayName}>{user.nickname}</Box>}\r\n      </Card>\r\n    </AudioVisualizer>\r\n  );\r\n};\r\n\r\nexport default GenericMediaCard;\r\n","import React, {useEffect, useState} from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box, Button, Input, DialogActions, FormControl, InputLabel, Select, Dialog, DialogTitle, DialogContent, MenuItem} from '@material-ui/core';\r\nimport {connect} from 'react-redux';\r\nimport GenericMediaCard from '../../Room/GenericMediaCard/GenericMediaCard';\r\nimport VideocamIcon from '@material-ui/icons/Videocam';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\nimport MicIcon from '@material-ui/icons/Mic';\r\nimport MicOffIcon from '@material-ui/icons/MicOff';\r\nimport {setMediaStreamConstraints, startLocalStream, stopLocalStream, toggleCameraEnabled, toggleMicrophoneEnabled} from '../../../store/actions/localStream.actions';\r\n\r\nconst useStyles = makeStyles({\r\n  wrapper: {\r\n    textAlign: 'center'\r\n  },\r\n  containerForm: {\r\n    maxWidth: '95vw'\r\n  },\r\n  formControl: {\r\n    display: 'block'\r\n  },\r\n  select: {\r\n    width: '100%',\r\n    marginBottom: '1rem'\r\n  }\r\n});\r\n\r\nconst MediaPreview = ({ dispatch, localStreamWrapper, mediaConstraints }) => {\r\n  const classes = useStyles();\r\n\r\n  const [microphones, setMicrophones] = useState(null);\r\n  const [cameras, setCameras] = useState(null);\r\n\r\n  const [currentMicrophone, setCurrentMicrophone] = useState(null);\r\n  const [currentCamera, setCurrentCamera] = useState(null);\r\n\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    initListOfDevices();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    handleSaveSettings();\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [currentCamera, currentMicrophone]);\r\n\r\n  useEffect(() => {\r\n    if (settingsOpen) {\r\n      dispatch(startLocalStream());\r\n    } else {\r\n      dispatch(stopLocalStream());\r\n    }\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [settingsOpen]);\r\n\r\n  useEffect(() => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack && microphones) {\r\n        const audioDevice = microphones.find(d => d.label === audioTrack.label);\r\n        if (audioDevice) {\r\n          setCurrentMicrophone(audioDevice);\r\n        }\r\n      }\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && cameras) {\r\n        const videoDevice = cameras.find(d => d.label === videoTrack.label);\r\n        if (videoDevice) {\r\n          setCurrentCamera(videoDevice);\r\n        }\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [localStreamWrapper]);\r\n\r\n  const setAudioIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack && audioTrack.enabled) {\r\n        return <MicIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <MicOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const setVideoIcon = () => { // TODO deduplicate toggle buttons for audio/video\r\n    if (localStreamWrapper) {\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && videoTrack.enabled) {\r\n        return <VideocamIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <VideocamOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const initListOfDevices = async () => {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    setMicrophones(devices.filter((device) => device.kind === 'audioinput'));\r\n    setCameras(devices.filter((device) => device.kind === 'videoinput'));\r\n  };\r\n\r\n  const handleChangeCurrentAudioDevice = evt => {\r\n    const selectedLabel = evt.target.value;\r\n    const selectedDevice = microphones.find(d => d.label === selectedLabel);\r\n    setCurrentMicrophone(selectedDevice || null);\r\n  };\r\n\r\n  const handleChangeCurrentVideoDevice = evt => {\r\n    const selectedLabel = evt.target.value;\r\n    const selectedDevice = cameras.find(d => d.label === selectedLabel);\r\n    setCurrentCamera(selectedDevice || null);\r\n  };\r\n\r\n  const handleClickOpen = async () => {\r\n    setSettingsOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setSettingsOpen(false);\r\n  };\r\n\r\n  const handleSaveSettings = async () => {\r\n    const newConstraints = { ...mediaConstraints };\r\n    if (currentMicrophone) {\r\n      newConstraints.audio = { ...newConstraints.audio, deviceId: currentMicrophone.deviceId };\r\n    }\r\n\r\n    if (currentCamera) {\r\n      newConstraints.video = { ...newConstraints.video, deviceId: currentCamera.deviceId };\r\n    }\r\n\r\n    if (currentMicrophone && currentCamera) {\r\n      await dispatch(setMediaStreamConstraints(newConstraints));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box className={classes.wrapper}>\r\n      <Button onClick={handleClickOpen}>Preview Audio & Video Settings</Button>\r\n\r\n      <div>\r\n        <Dialog disableBackdropClick disableEscapeKeyDown open={settingsOpen} onClose={(handleClose)}>\r\n          <DialogTitle>Audio & Video Settings</DialogTitle>\r\n          <DialogContent>\r\n\r\n            <GenericMediaCard stream={localStreamWrapper ? localStreamWrapper.stream : null} muted={false}/>\r\n            {/* toggle Camera enabled */}\r\n            <Button style={{ height: '100%' }} onClick={() => dispatch(toggleCameraEnabled())}>\r\n              {setVideoIcon()}\r\n            </Button>\r\n            {/* toggle Microphone enabled */}\r\n            <Button style={{ height: '100%' }} onClick={() => dispatch(toggleMicrophoneEnabled())}>\r\n              {setAudioIcon()}\r\n            </Button>\r\n\r\n            <form className={classes.containerForm}>\r\n              <FormControl className={classes.formControl}>\r\n                <InputLabel htmlFor=\"select-mic\">Audio Input (Microphone)</InputLabel>\r\n                <Select\r\n                  className={classes.select}\r\n                  value={currentMicrophone ? currentMicrophone.label : ''}\r\n                  onChange={handleChangeCurrentAudioDevice}\r\n                  input={<Input id=\"select-mic\"/>}\r\n                >\r\n                  {microphones && microphones.map((mic, i) => <MenuItem key={mic.groupId + i} value={mic.label}>{mic.label}</MenuItem>)}\r\n                </Select>\r\n              </FormControl>\r\n              <FormControl className={classes.formControl}>\r\n                <InputLabel htmlFor=\"select-cam\">Video Input (Camera)</InputLabel>\r\n                <Select\r\n                  className={classes.select}\r\n                  value={currentCamera ? currentCamera.label : ''}\r\n                  onChange={handleChangeCurrentVideoDevice}\r\n                  input={<Input id=\"select-cam\"/>}\r\n                >\r\n                  {cameras && cameras.map((cam, i) => <MenuItem key={cam.groupId + i} value={cam.label}>{cam.label}</MenuItem>)}\r\n                </Select>\r\n              </FormControl>\r\n            </form>\r\n          </DialogContent>\r\n\r\n          <DialogActions>\r\n            <Button onClick={handleClose} color=\"primary\">Close</Button>\r\n            {/*<Button onClick={handleSaveSettings} color=\"primary\">Save</Button>*/}\r\n          </DialogActions>\r\n\r\n        </Dialog>\r\n      </div>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    localStreamWrapper: state.localUser.mediaStream,\r\n    mediaConstraints: state.localUser.mediaConstraints\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(MediaPreview);\r\n","import React, {useState} from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box, Button, Grid, TextField, Typography} from '@material-ui/core';\r\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\r\nimport {setMetadata} from '../../store/actions/localUser.actions';\r\nimport {connect} from 'react-redux';\r\nimport {setCurrentRoomError, setVisitedLobby} from '../../store/actions/room.actions';\r\nimport MediaPreview from './MediaPreview/MediaPreview';\r\n\r\nconst useStyles = makeStyles({\r\n  containerStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    paddingTop: '128px'\r\n  },\r\n  titleStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    width: '100%',\r\n    padding: '16px',\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    backgroundColor: '#388E3C'\r\n  },\r\n  nicknameStyle: {\r\n    width: '90%',\r\n    margin: '16px'\r\n  },\r\n  textfieldLink: {\r\n    width: '90%',\r\n    marginRight: '16px',\r\n    marginLeft: '16px'\r\n  },\r\n  nextButton: {\r\n    color: 'white',\r\n    boxShadow: 'none',\r\n    width: '100%'\r\n\r\n  },\r\n  alignbutton: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    width: '80%',\r\n    marginTop: '24px',\r\n    marginBottom: '24px'\r\n  }\r\n});\r\n\r\nconst RoomLobby = ({ dispatch, history, match, nickname, roomError }) => {\r\n  const [newNickname, setNewNickname] = useState(nickname);\r\n  const [link, setLink] = useState(match.params.roomId);\r\n  const classes = useStyles();\r\n\r\n  const handleChangeName = (e) => {\r\n    setNewNickname(e.target.value);\r\n  };\r\n\r\n  const handleChangeLink = (e) => {\r\n    setLink(e.target.value);\r\n  };\r\n\r\n  const handleKeyPress = (e) => {\r\n    if (e.key === 'Enter') {\r\n      handleJoin();\r\n    }\r\n  };\r\n\r\n  const handleJoin = async (e) => {\r\n    dispatch(setMetadata({ nickname: newNickname }));\r\n    dispatch(setVisitedLobby(true));\r\n    dispatch(setCurrentRoomError(null));\r\n    history.push(`/rooms/${match.params.roomId}`);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Box display='flex' height={63} bgcolor='#2E7D32' alignItems='center' paddingLeft='36px'>\r\n        <Link to=\"/\" style={{ textDecoration: 'none', color: 'white' }}><ArrowBackIosIcon/></Link>\r\n      </Box>\r\n      <Grid container className={classes.containerStyle}>\r\n        <Grid item xs={11} md={6} lg={5}>\r\n          <Box display='flex' flexDirection='column' alignItems='center' width={'100%'} borderRadius='5px' bgcolor='white'>\r\n            <Typography variant='h4' className={classes.titleStyle}>Enter the room</Typography>\r\n            <TextField\r\n              required\r\n              label=\"Nickname\"\r\n              variant=\"outlined\"\r\n              value={newNickname}\r\n              className={classes.nicknameStyle}\r\n              onChange={handleChangeName}\r\n              onKeyPress={handleKeyPress}\r\n              autoFocus\r\n            />\r\n            <TextField\r\n              required\r\n              label=\"Room ID\"\r\n              variant=\"outlined\"\r\n              value={link}\r\n              className={classes.textfieldLink}\r\n              onChange={handleChangeLink}\r\n            />\r\n            <div className={classes.alignbutton}>\r\n              <Button onClick={handleJoin} size=\"large\" color=\"secondary\" variant=\"contained\" className={classes.nextButton}>\r\n                join\r\n              </Button>\r\n            </div>\r\n            {roomError && <Box color={'red'} textAlign={'center'}>{roomError.error.message}</Box>}\r\n          </Box>\r\n          <MediaPreview/>\r\n        </Grid>\r\n      </Grid>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  nickname: state.localUser.metadata.nickname || '',\r\n  roomError: state.room.error\r\n});\r\n\r\nexport default connect(mapStateToProps)(RoomLobby);\r\n","import {SET_PLUGIN} from '../actionTypes';\r\nimport {sendDataToConnection} from './connections.actions';\r\n\r\nexport const setPlugin = plugin => (dispatch, getState) => {\r\n  // temporary simplified action\r\n  if (plugin) {\r\n    dispatch({ type: SET_PLUGIN, payload: { plugin } });\r\n  }\r\n};\r\n\r\nconst sendPluginMessageToAllConnections = (evt) => (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n  const data = { type: 'PLUGIN_DATA', payload: evt.data.payload };\r\n  connections.forEach(connection => {\r\n    dispatch(sendDataToConnection(connection.defaultDataChannel, data)); // TODO seperate dataChannel exclusive for plugin data\r\n  });\r\n};\r\n\r\nconst sendPluginMessageToConnection = (evt) => (dispatch, getState) => {\r\n  const { peerId, payload } = evt.data;\r\n  const connection = getState().connections.data[peerId];\r\n  const data = { type: 'PLUGIN_DATA', payload: payload };\r\n  dispatch(sendDataToConnection(connection.defaultDataChannel, data));\r\n};\r\n\r\n// const handlePluginRequestLocalPeer = () => (dispatch, getState) => {\r\n//     try {\r\n//         // TODO verify plugin has PLUGIN_REQUEST_LOCAL_PEER listed in required permissions and user accepted it on start of plugin\r\n//         //  A plugin will have some kind of manifest file (potentially just a .json) for all kinds of metadata like required permissions, name, max users etc\r\n//         // TODO when opening any plugin for the first time, a prompt opens informing user of the required permissions\r\n//         //  he also needs to give his consent by clicking a button which will whitelist the plugin (localstorage for the beginning)\r\n//         const peerId = getState().localUser.peer.id;\r\n//         const data = {type: 'PLUGIN_REQUEST_LOCAL_PEER_GRANT', payload: {peer: peerId}};\r\n//\r\n//         const iframe = getState().plugin.iframe;\r\n//         if (iframe) {\r\n//             iframe.contentWindow.postMessage(data, \"*\");\r\n//         }\r\n//     } catch (err) {\r\n//         console.error('handleRequestLocalPeer error', err);\r\n//     }\r\n// };\r\n\r\nconst pluginMessageActions = {\r\n  'PLUGIN_SEND_TO_ALL_PEERS': sendPluginMessageToAllConnections,\r\n  'PLUGIN_SEND_TO_PEER': sendPluginMessageToConnection,\r\n  // 'PLUGIN_REQUEST_LOCAL_PEER': handlePluginRequestLocalPeer,\r\n  'PLUGIN_PLATFORM_CONTROL_REQUEST': () => console.log('plugin is requesting something from the platform (mute local user, rumble screen, etc')\r\n};\r\n\r\nexport const handlePluginMessage = (evt) => async (dispatch, getState) => {\r\n  if (evt.data.type && evt.data.type.startsWith('PLUGIN')) {\r\n    const action = pluginMessageActions[evt.data.type];\r\n    dispatch(action(evt));\r\n  }\r\n};\r\n","import React, {useEffect, useRef} from 'react';\r\nimport {Box} from '@material-ui/core';\r\nimport {connect} from 'react-redux';\r\nimport {handlePluginMessage, setPlugin} from '../../../store/actions/plugin.actions';\r\n\r\nconst RoomPluginContent = ({ dispatch, plugin }) => {\r\n  const iframeRef = useRef();\r\n\r\n  useEffect(() => {\r\n    const handleMessage = (evt) => {\r\n      dispatch(handlePluginMessage(evt));\r\n    };\r\n    window.addEventListener('message', handleMessage);\r\n    return () => window.removeEventListener('message', handleMessage);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (iframeRef && iframeRef.current) {\r\n      dispatch(setPlugin({ ...plugin, iframe: iframeRef.current }));\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [iframeRef, plugin.url]);\r\n\r\n  return (\r\n    <Box flexGrow={1}>\r\n      {plugin && plugin.url && <iframe src={plugin.url} style={{ width: '100%', height: '100%', border: 'none' }} ref={iframeRef} title={'plugin'}/>}\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  plugin: state.plugin\r\n});\r\n\r\nexport default connect(mapStateToProps)(RoomPluginContent);\r\n","import React from 'react';\r\nimport GenericMediaCard from '../../GenericMediaCard/GenericMediaCard';\r\nimport {connect} from 'react-redux';\r\n\r\nconst RemoteMediaCard = ({ remoteStream, remoteNickname }) => <GenericMediaCard stream={remoteStream} user={{ nickname: remoteNickname }}/>;\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  const remoteSocketId = ownProps.connection.remoteSocketId;\r\n  const remoteStreamWrapper = remoteSocketId ? state.remoteStreams.data[remoteSocketId] : null;\r\n  const remoteStream = remoteStreamWrapper ? remoteStreamWrapper.stream : null;\r\n  const remoteMetadata = state.peers.data[remoteSocketId] ? state.peers.data[remoteSocketId].metadata : {};\r\n  return {\r\n    remoteStream: remoteStream,\r\n    remoteNickname: remoteMetadata.nickname || 'missing Nickname'\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RemoteMediaCard);\r\n","import React from 'react';\r\nimport {connect} from 'react-redux';\r\nimport RemoteMediaCard from '../RemoteMediaCard/RemoteMediaCard';\r\n\r\nconst RemoteMediaManager = ({ connections }) => {\r\n  return (\r\n    <>\r\n      {connections && connections.map((connection) => <RemoteMediaCard key={'conn' + connection.remoteSocketId} connection={connection}/>)}\r\n    </>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n  connections: Object.values(state.connections.data)\r\n});\r\n\r\nexport default connect(mapStateToProps)(RemoteMediaManager);\r\n","import React from 'react';\r\nimport {connect} from 'react-redux';\r\nimport GenericMediaCard from '../GenericMediaCard/GenericMediaCard';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box} from '@material-ui/core';\r\nimport RemoteMediaManager from './RemoteMediaManager/RemoteMediaManager';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  roomMediaManager: {\r\n    padding: '5px',\r\n    backgroundColor: '#f5deb340',\r\n    borderLeft: '1px solid #0000003b'\r\n  }\r\n}));\r\n\r\nconst RoomMediaManager = ({ localStream, localPeerMetadata }) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <Box bgcolor='lightblue' width={'220px'} minWidth={'150px'} className={classes.roomMediaManager}>\r\n      <GenericMediaCard stream={localStream} muted={true} user={{ nickname: localPeerMetadata.nickname }}/>\r\n      <RemoteMediaManager/>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  const localStreamWrapper = state.localUser.mediaStream;\r\n  const localStream = localStreamWrapper ? localStreamWrapper.stream : null;\r\n  return {\r\n    localPeerMetadata: state.localUser.metadata,\r\n    localStream: localStream\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RoomMediaManager);\r\n","import React, {useState} from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {List, ListItem, ListItemIcon, ListItemText, Divider, Button, Drawer} from '@material-ui/core';\r\nimport LabelIcon from '@material-ui/icons/Label';\r\nimport WidgetsOutlinedIcon from '@material-ui/icons/WidgetsOutlined';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport {setPlugin} from '../../../store/actions/plugin.actions';\r\nimport {connect} from 'react-redux';\r\n\r\nconst useStyles = makeStyles({\r\n  list: {\r\n    width: 250\r\n  },\r\n  menuIcon: {\r\n    margin: '8px'\r\n  }\r\n});\r\n\r\n// TODO this data will be served by the backend in future releases. Not real plugins except first one in the list\r\nconst plugins = [\r\n  { name: 'Random number', url: 'https://andreas-schoch.github.io/p2p-test-plugin/' },\r\n  { name: 'Paint', url: 'https://andreas-schoch.github.io/quackamole-plugin-paint/' },\r\n  { name: 'Gomoku', url: 'https://quackamole-dev.github.io/quackamole-plugin-gomoku/' },\r\n  { name: '2d Shooter (WIP)', url: 'https://andreas-schoch.github.io/quackamole-plugin-2d-topdown-shooter/' },\r\n  { name: 'Breakout game', url: 'https://andreas-schoch.github.io/breakout-game/' }\r\n];\r\n\r\nconst RoomSidebarMenu = ({ dispatch, plugin }) => {\r\n  const classes = useStyles();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const toggleDrawer = (event) => {\r\n    if (event.type === 'keydown') {\r\n      return;\r\n    }\r\n    setOpen(!open);\r\n  };\r\n\r\n  const handleSelectPlugin = (evt) => {\r\n    const index = evt.currentTarget.dataset.index;\r\n    dispatch(setPlugin(plugin ? { ...plugin, ...plugins[index] } : plugins[index]));\r\n  };\r\n\r\n  const list = () => (\r\n    <div className={classes.list} role=\"presentation\" onClick={toggleDrawer}>\r\n      <List>\r\n        {plugins.map(({ name }, i) => (\r\n          <ListItem button key={name} onClick={handleSelectPlugin} data-index={i}>\r\n            <ListItemIcon><LabelIcon/></ListItemIcon>\r\n            <ListItemText primary={name}/>\r\n          </ListItem>\r\n        ))}\r\n      </List>\r\n      <Divider/>\r\n      <List>\r\n        <ListItem button>\r\n          <ListItemIcon><WidgetsOutlinedIcon/></ListItemIcon>\r\n          <ListItemText primary={'Browse Plugins'}/>\r\n        </ListItem>\r\n      </List>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n      <Button>\r\n        <MenuIcon onClick={toggleDrawer} color='primary' fontSize='large' className={classes.menuIcon}/>\r\n        <Drawer open={open} onClose={toggleDrawer} anchor={'left'}>\r\n          {list()}\r\n        </Drawer>\r\n      </Button>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  plugin: state.plugin\r\n});\r\n\r\nexport default connect(mapStateToProps)(RoomSidebarMenu);\r\n","import React from 'react';\r\nimport cx from 'clsx'; // TODO This comes from some example code, it has some nice features but we need to discuss whether we want to use it\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport {Avatar, Grid, Typography} from '@material-ui/core';\r\nimport defaultChatMsgStyles from './ChatStyle';\r\n\r\nconst ChatMsg = withStyles(defaultChatMsgStyles, { name: 'ChatMsg' })(props => {\r\n  const {\r\n    classes,\r\n    avatar,\r\n    messages,\r\n    side,\r\n    GridContainerProps,\r\n    GridItemProps,\r\n    AvatarProps,\r\n    getTypographyProps\r\n  } = props;\r\n\r\n  const attachClass = index => {\r\n    if (index === 0) {\r\n      return classes[`${side}First`];\r\n    }\r\n    if (index === messages.length - 1) {\r\n      return classes[`${side}Last`];\r\n    }\r\n    return '';\r\n  };\r\n  return (\r\n    <Grid container spacing={2} justify={side === 'right' ? 'flex-end' : 'flex-start'}{...GridContainerProps} className={classes.wrapper}>\r\n      {side === 'left' && (\r\n        <Grid item {...GridItemProps}>\r\n          <Avatar src={avatar}{...AvatarProps} className={cx(classes.avatar, AvatarProps.className)}/>\r\n        </Grid>\r\n      )}\r\n      <Grid item xs={8}>\r\n        {messages.map((msg, i) => {\r\n          const TypographyProps = getTypographyProps(msg, i, props);\r\n          return (\r\n            <div key={msg.id || i} className={classes[`${side}Row`]}>\r\n              <Typography align={'left'} {...TypographyProps} className={cx(classes.msg, classes[side], attachClass(i), TypographyProps.className)}>\r\n                {msg}\r\n              </Typography>\r\n            </div>\r\n          );\r\n        })}\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n});\r\n\r\nChatMsg.defaultProps = {\r\n  avatar: '',\r\n  messages: [],\r\n  side: 'left',\r\n  GridContainerProps: {},\r\n  GridItemProps: {},\r\n  AvatarProps: {},\r\n  getTypographyProps: () => ({})\r\n};\r\n\r\nexport default ChatMsg;\r\n","export default ({ palette, spacing }) => {\r\n  const radius = spacing(2.5);\r\n  const size = spacing(4);\r\n  const rightBgColor = palette.primary.main;\r\n  return {\r\n    wrapper: {\r\n      '&:nth-child(1)': {\r\n        marginTop: 'auto' // https://bugs.chromium.org/p/chromium/issues/detail?id=411624\r\n      }\r\n    },\r\n    avatar: {\r\n      width: size,\r\n      height: size\r\n    },\r\n    leftRow: {\r\n      textAlign: 'left'\r\n    },\r\n    rightRow: {\r\n      textAlign: 'right'\r\n    },\r\n    msg: {\r\n      padding: spacing(1, 2),\r\n      borderRadius: 4,\r\n      marginBottom: 4,\r\n      display: 'inline-block',\r\n      wordBreak: 'break-word',\r\n      fontFamily: 'Roboto, Helvetica, Arial, sans-serif',\r\n      fontSize: '14px'\r\n    },\r\n    left: {\r\n      borderTopRightRadius: radius,\r\n      borderBottomRightRadius: radius,\r\n      backgroundColor: palette.grey[100]\r\n    },\r\n    right: {\r\n      borderTopLeftRadius: radius,\r\n      borderBottomLeftRadius: radius,\r\n      backgroundColor: rightBgColor,\r\n      color: palette.common.white\r\n    },\r\n    leftFirst: {\r\n      borderTopLeftRadius: radius\r\n    },\r\n    leftLast: {\r\n      borderBottomLeftRadius: radius\r\n    },\r\n    rightFirst: {\r\n      borderTopRightRadius: radius\r\n    },\r\n    rightLast: {\r\n      borderBottomRightRadius: radius\r\n    }\r\n  };\r\n};\r\n","import React, {useEffect, useRef, useState} from 'react';\r\nimport ChatMsg from './ChatMsg';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {TextField} from '@material-ui/core';\r\nimport SendIcon from '@material-ui/icons/Send';\r\nimport {connect} from 'react-redux';\r\nimport {sendMessage} from '../../../../store/actions/chat.actions';\r\n\r\nconst useStyles = makeStyles({\r\n  chat: {\r\n    height: '100vh',\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    width: '320px'\r\n  },\r\n  chatFeed: {\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    flexGrow: 1,\r\n    maxHeight: 'calc(100% - 60px)',\r\n    overflow: 'auto',\r\n    padding: '8px'\r\n  },\r\n  chatInput: {\r\n    display: 'flex',\r\n    flexFlow: 'row nowrap',\r\n    alignItems: 'flex-end',\r\n    padding: '8px'\r\n  },\r\n  chatInputTextfield: {\r\n    flexGrow: 1,\r\n    zIndex: 1000,\r\n    backgroundColor: 'white'\r\n  },\r\n  chatInputSendBtn: {\r\n    fontSize: '40px',\r\n    margin: 'auto 5px',\r\n    cursor: 'pointer',\r\n    opacity: 0.8,\r\n    transition: 'opacity 0.2s',\r\n    '&:hover': {\r\n      opacity: 0.95\r\n    }\r\n  }\r\n});\r\n\r\nconst Chat = ({ dispatch, chatData, socket }) => {\r\n  const classes = useStyles('');\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const feedRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (feedRef.current) {\r\n      feedRef.current.scrollTop = feedRef.current.scrollHeight;\r\n    }\r\n  }, [chatData]);\r\n\r\n  const handleChangeTexfield = (event) => {\r\n    setNewMessage(event.target.value);\r\n  };\r\n\r\n  const handleKeyPress = (event) => {\r\n    if (event.key === 'Enter') {\r\n      if (event.shiftKey) {\r\n        setNewMessage(newMessage.concat('\\n'));\r\n      } else {\r\n        send(event);\r\n      }\r\n    }\r\n  };\r\n\r\n  const send = (e) => {\r\n    e.preventDefault();\r\n    if (newMessage.replace(/\\n/g, '').length) {\r\n      dispatch(sendMessage(newMessage));\r\n      setNewMessage('');\r\n    }\r\n  };\r\n\r\n  //handle the chat feed to display all messages on the right position\r\n  const chatMessages = chatData.map((message, i) => message.authorSocketId === socket.id\r\n    ? <ChatMsg key={i} side={'right'} messages={[message.text]}/>\r\n    : <ChatMsg key={i} avatar={''} messages={[message.text]}/>\r\n  );\r\n\r\n  return (\r\n    <div className={classes.chat}>\r\n\r\n      <div className={classes.chatFeed} ref={feedRef}>\r\n        {chatMessages}\r\n      </div>\r\n\r\n      <div className={classes.chatInput}>\r\n        <TextField\r\n          variant=\"outlined\"\r\n          multiline\r\n          rowsMax={5}\r\n          className={classes.chatInputTextfield}\r\n          onChange={handleChangeTexfield}\r\n          onKeyPress={handleKeyPress}\r\n          value={newMessage}\r\n          autoFocus\r\n        />\r\n        <SendIcon className={classes.chatInputSendBtn} onClick={send}/>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n  chatData: state.chat,\r\n  socket: state.localUser.socket\r\n});\r\n\r\nexport default connect(mapStateToProps)(Chat);\r\n","import {ADD_NEW_MESSAGE} from '../actionTypes';\r\nimport {sendDataToConnection} from './connections.actions';\r\n\r\nexport const sendMessage = (text) => async (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n  const socket = getState().localUser.socket;\r\n\r\n  if (socket) {\r\n    connections.forEach(connection => {\r\n      // FIXME change to use separate data channel only for chat instead of identifying it by type or specific properties\r\n      const message = {\r\n        textMessage: { text: text, authorSocketId: socket.id }\r\n      };\r\n\r\n      dispatch(sendDataToConnection(connection.defaultDataChannel, message));\r\n    });\r\n\r\n    dispatch({\r\n      type: ADD_NEW_MESSAGE,\r\n      payload: { text: text, authorSocketId: socket.id }\r\n    });\r\n  } else {\r\n    console.error('socket not found');\r\n  }\r\n};\r\n","import React, {useState} from 'react';\r\nimport {Button, Drawer} from '@material-ui/core';\r\nimport ChatIcon from '@material-ui/icons/Chat';\r\nimport Chat from './Chat/Chat';\r\n\r\nconst RoomSidebarChat = () => {\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const toggleDrawer = _ => setOpen(!open);\r\n\r\n  return (\r\n    <div>\r\n      <Button onClick={toggleDrawer}>\r\n        <ChatIcon color='primary' fontSize='large'/>\r\n      </Button>\r\n      <Drawer open={open} onClose={toggleDrawer} anchor={'right'}>\r\n        <Chat/>\r\n      </Drawer>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RoomSidebarChat;\r\n","import React from 'react';\r\nimport {Box, Button} from '@material-ui/core';\r\nimport HomeIcon from '@material-ui/icons/Home';\r\nimport MicOffIcon from '@material-ui/icons/MicOff';\r\nimport RoomSidebarMenu from '../RoomSidebarMenu/RoomSidebarMenu';\r\nimport MicIcon from '@material-ui/icons/Mic';\r\nimport VideocamIcon from '@material-ui/icons/Videocam';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\nimport RoomSidebarChat from '../RoomSidebarChat/RoomSidebarChat';\r\nimport {Link} from 'react-router-dom';\r\nimport {connect} from 'react-redux';\r\nimport {toggleCameraEnabled, toggleMicrophoneEnabled} from '../../../store/actions/localStream.actions';\r\n\r\n// TODO make actionbar modular once gridsystem is in place\r\nconst RoomActionbar = ({ localStreamWrapper, dispatch }) => {\r\n\r\n  const setAudioIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack && audioTrack.enabled) {\r\n        return <MicIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <MicOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const setVideoIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && videoTrack.enabled) {\r\n        return <VideocamIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <VideocamOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      bgcolor={'#f5deb3eb'}\r\n      height={'10%'}\r\n      display='flex'\r\n      justifyContent={'center'}\r\n      borderTop={'1px solid #0000003b'}\r\n      alignItems={'center'}\r\n    >\r\n      {/* toggle room menu settings */}\r\n      <RoomSidebarMenu/>\r\n\r\n      {/* toggle Microphone audio track */}\r\n      <Button style={{ height: '100%', marginLeft: 'auto' }} onClick={() => dispatch(toggleMicrophoneEnabled())}>\r\n        {setAudioIcon()}\r\n      </Button>\r\n\r\n      {/* Navigate to landing page */}\r\n      <Link to={'/'} style={{ height: '100%' }}>\r\n        <Button style={{ height: '100%' }}>\r\n          <HomeIcon color='primary' fontSize='large'/>\r\n        </Button>\r\n      </Link>\r\n\r\n      {/* toggle camera video track */}\r\n      <Button style={{ height: '100%', marginRight: 'auto' }} onClick={() => dispatch(toggleCameraEnabled())}>\r\n        {setVideoIcon()}\r\n      </Button>\r\n\r\n      {/* toggle chat */}\r\n      <RoomSidebarChat/>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    localStreamWrapper: state.localUser.mediaStream\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RoomActionbar);\r\n","import React, {useEffect} from 'react';\r\nimport {Box} from '@material-ui/core';\r\nimport RoomPluginContent from './RoomPluginContent/RoomPluginContent';\r\nimport RoomMediaManager from './RoomMediaManager/RoomMediaManager';\r\nimport {connect} from 'react-redux';\r\nimport {joinRoom} from '../../store/actions/connections.actions';\r\nimport {initLocalUser} from '../../store/actions/localUser.actions';\r\nimport RoomActionbar from './RoomActionbar/RoomActionbar';\r\nimport {roomExitCleanup} from '../../store/actions/room.actions';\r\n\r\nconst Room = ({ dispatch, socket, match, history, roomError, currentRoom, localPeerLoading, visitedLobby }) => {\r\n\r\n  useEffect(() => {\r\n    if (roomError || !visitedLobby) {\r\n      history.push(`/room-lobby/${match.params.roomId}`);\r\n    } else if (!socket && !localPeerLoading) {\r\n      dispatch(initLocalUser());\r\n    } else if (socket && socket.id && !currentRoom.id) {\r\n      dispatch(joinRoom(match.params.roomId, 'dummy123'));\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [roomError, socket]);\r\n\r\n  useEffect(() => {\r\n    // unmount\r\n    return () => dispatch(roomExitCleanup());\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Box display='flex' flexDirection='column' width={1} height={'100%'} justifyContent={'space-between'}>\r\n        <Box display='flex' flexDirection='row' width={1} height={'90%'} justifyContent={'space-between'}>\r\n          <RoomPluginContent/>\r\n          <RoomMediaManager/>\r\n        </Box>\r\n        <RoomActionbar/>\r\n      </Box>\r\n    </>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    socket: state.localUser.socket,\r\n    localPeerLoading: state.localUser.loading,\r\n    roomError: state.room.error,\r\n    currentRoom: state.room.data,\r\n    visitedLobby: state.room.visitedLobby\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Room);\r\n","export const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || window.location.origin;\r\n","import React from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Typography, useMediaQuery} from '@material-ui/core';\r\nimport AssessmentOutlinedIcon from '@material-ui/icons/AssessmentOutlined';\r\nimport CallOutlinedIcon from '@material-ui/icons/CallOutlined';\r\nimport VideogameAssetIcon from '@material-ui/icons/VideogameAsset';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: 314,\r\n    height: 400,\r\n    border: 'solid 1px lightgrey',\r\n    backgroundColor: 'white'\r\n  },\r\n  smallScreenContainer: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: 314,\r\n    height: 400,\r\n    border: 'solid 1px lightgrey',\r\n    backgroundColor: 'white',\r\n    margin: 8\r\n  },\r\n  alignTitle: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    margin: 24\r\n  },\r\n  customizeTitle: {\r\n    fontWeight: 'bold',\r\n    fontSize: '25px',\r\n    marginLeft: 4\r\n  },\r\n  customizeIcon: {\r\n    marginRight: 4,\r\n    color: 'rgb(46, 125, 50)'\r\n  },\r\n  customizeText: {\r\n    paddingLeft: 16,\r\n    paddingRight: 16,\r\n    marginBottom: 16\r\n  }\r\n});\r\n\r\nconst BulletPoint = (props) => {\r\n  const classes = useStyles();\r\n  const smallScreen = useMediaQuery('(max-width: 950px)');\r\n\r\n  const checkIcons = (icon) => {\r\n    if (icon === 'VideogameAssetIcon') {\r\n      return <VideogameAssetIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    } else if (icon === 'AssessmentOutlinedIcon') {\r\n      return <AssessmentOutlinedIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    } else if (icon === 'CallOutlinedIcon') {\r\n      return <CallOutlinedIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={smallScreen ? classes.smallScreenContainer : classes.container}>\r\n      <div className={classes.alignTitle}>\r\n        {checkIcons(props.content.icon)}\r\n        <Typography variant='h4' className={classes.customizeTitle}>{props.content.title}</Typography>\r\n      </div>\r\n      <Typography className={classes.customizeText} align='center'>{props.content.text}</Typography>\r\n      <img src={props.content.image} height='181' width='275' alt='icon'/>\r\n    </div>\r\n  );\r\n};\r\nexport default BulletPoint;\r\n","import React from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Typography, Box, Button, useMediaQuery} from '@material-ui/core';\r\nimport {Link} from 'react-router-dom';\r\nimport BulletPoint from './BulletPoint/BulletPoint';\r\n\r\nconst useStyles = makeStyles({\r\n  header: {\r\n    color: 'white',\r\n    textTransform: 'uppercase',\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center'\r\n  },\r\n  box: {\r\n    display: 'flex',\r\n    width: '100%',\r\n    height: '100%',\r\n    justifyContent: 'center'\r\n  },\r\n  smallScreenBox: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    width: '100%',\r\n    height: '100%',\r\n    alignItems: 'center'\r\n  },\r\n  titleContainer: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: '40%',\r\n    minWidth: 310\r\n  },\r\n  titleStyle: {\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    marginTop: '98px'\r\n  },\r\n  buttonStyle: {\r\n    borderRadius: '5px',\r\n    fontWeight: 'bold',\r\n    color: 'white',\r\n    backgroundColor: '#FBC02D',\r\n    '&:hover': {\r\n      backgroundColor: '#f9a825'\r\n    },\r\n    '&:focus': {\r\n      outline: 0\r\n    }\r\n  },\r\n  mainImg: {\r\n    display: 'flex',\r\n    height: 224,\r\n    width: 309,\r\n    borderRadius: 5,\r\n    marginTop: 76,\r\n    marginLeft: 36,\r\n    marginRight: 36\r\n  },\r\n  smallScreenMainImg: {\r\n    display: 'flex',\r\n    height: 224,\r\n    width: 309,\r\n    borderRadius: 5,\r\n    margin: 36\r\n  },\r\n  bulletPoints: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    zIndex: '3',\r\n    position: 'relative',\r\n    bottom: 150\r\n  },\r\n  smallScreenBulletPoints: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    marginTop: 72\r\n  }\r\n});\r\n\r\nconst Home = () => {\r\n  const classes = useStyles();\r\n  const smallScreen = useMediaQuery('(max-width: 950px)');\r\n  const bulletPoints = [\r\n    {\r\n      title: 'Gaming',\r\n      icon: 'VideogameAssetIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    },\r\n    {\r\n      title: 'Working',\r\n      icon: 'AssessmentOutlinedIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    },\r\n    {\r\n      title: 'Chatting',\r\n      icon: 'CallOutlinedIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <div>\r\n      {/* Header */}\r\n      <Box height={63} bgcolor='#2E7D32' className={classes.header}>\r\n        <h1>\r\n          <span role={'img'} aria-label={'a duck'}> </span>\r\n          Quackamole\r\n          <span role={'img'} aria-label={'an avocado'}> </span>\r\n        </h1>\r\n      </Box>\r\n\r\n      {/* Body */}\r\n      <Box height={540} display='flex' zIndex={1}>\r\n        <Box className={smallScreen ? classes.smallScreenBox : classes.box} bgcolor='#388E3C'>\r\n          <div className={classes.titleContainer}>\r\n            <Typography variant='h3' className={classes.titleStyle} gutterBottom align='center'>\r\n              Peer-to-peer video chat platform\r\n            </Typography>\r\n            <Link to=\"/create-room\" style={{ textDecoration: 'none' }}>\r\n              <Button size=\"large\" className={classes.buttonStyle}>Create a room</Button>\r\n            </Link>\r\n          </div>\r\n          <img\r\n            src='https://via.placeholder.com/400x300'\r\n            className={smallScreen ? classes.smallScreenMainImg : classes.mainImg}\r\n            alt={'quackamole room preview'}\r\n          />\r\n        </Box>\r\n      </Box>\r\n\r\n      {/* Bullet Points */}\r\n      <div className={smallScreen ? classes.smallScreenBulletPoints : classes.bulletPoints}>\r\n        {bulletPoints.map((data, i) => <BulletPoint content={data} key={data.title + i}> </BulletPoint>)}\r\n      </div>\r\n\r\n      {/*Temporary for debugging purposes*/}\r\n      <Link to={'/rooms/dummy-room-id'}>Test room</Link>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n","import {createMuiTheme} from '@material-ui/core/styles';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#2E7D32'\r\n    },\r\n    secondary: {\r\n      main: '#FBC02D'\r\n    }\r\n  }\r\n});\r\n\r\nexport default theme;\r\n","import React, {useState} from 'react';\r\nimport {Link, useHistory} from 'react-router-dom';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box, Button, Grid, TextField, Typography} from '@material-ui/core';\r\nimport theme from '../../style/theme/MainTheme';\r\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport {BACKEND_URL} from '../../constants';\r\n\r\nconst useStyles = makeStyles({\r\n  containerStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    paddingTop: '128px'\r\n  },\r\n  titleStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    padding: '16px',\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    backgroundColor: '#388E3C',\r\n    width: '100%'\r\n  },\r\n  formControl: {\r\n    width: '20%',\r\n    margin: '16px'\r\n  },\r\n  select: {\r\n    borderColor: '#FB8C00',\r\n    '&:before': {\r\n      borderColor: '#FB8C00'\r\n    },\r\n    '&:after': {\r\n      borderColor: '#f57c00'\r\n    }\r\n  },\r\n  textfield: {\r\n    width: '90%',\r\n    marginTop: '48px'\r\n  },\r\n  textfieldLink: {\r\n    width: '90%',\r\n    marginRight: '16px',\r\n    marginLeft: '16px'\r\n  },\r\n  alignButton: {\r\n    display: 'flex',\r\n    justifyContent: 'flex-end',\r\n    width: '100%',\r\n    padding: '16px'\r\n  },\r\n  btnCreateWrapper: {\r\n    position: 'relative'\r\n  },\r\n  btnCreate: {\r\n    color: 'white',\r\n    boxShadow: 'none'\r\n  },\r\n  fabProgress: {\r\n    position: 'absolute',\r\n    top: -6,\r\n    left: -6,\r\n    zIndex: 1\r\n  },\r\n  btnCreateProgress: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    marginTop: -12,\r\n    marginLeft: -12\r\n  },\r\n  paper: {\r\n    padding: theme.spacing(2),\r\n    textAlign: 'center',\r\n    color: theme.palette.text.secondary\r\n  },\r\n  copyLink: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    marginTop: '16px',\r\n    width: '90%'\r\n  },\r\n  nextButton: {\r\n    color: 'white',\r\n    boxShadow: 'none',\r\n    marginBottom: '16px',\r\n    width: '100%'\r\n  },\r\n  subtitle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    margin: '16px'\r\n  }\r\n});\r\n\r\nconst RoomCreateForm = () => {\r\n  const [name, setName] = useState('');\r\n  const [link, setLink] = useState('');\r\n  const [roomId, setRoomId] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const classes = useStyles();\r\n  const history = useHistory();\r\n\r\n  const handleChangeTexfield = (event) => {\r\n    setName(event.target.value);\r\n  };\r\n\r\n  const handleKeyPress = async (evt) => {\r\n    if (!loading && evt.key === 'Enter') {\r\n      if (!roomId) {\r\n        await createRoom();\r\n      } else if (!error && roomId) {\r\n        history.push(`/room-lobby/${roomId}`);\r\n      }\r\n\r\n    }\r\n  };\r\n\r\n  const createRoom = async () => {\r\n    try {\r\n      let data = {\r\n        name: name,\r\n        password: 'Test123.',\r\n        maxUsers: 4\r\n      };\r\n\r\n      if (data.name.length === 0) {\r\n        setError(new Error('The room needs a name'));\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      const res = await fetch(`${BACKEND_URL}/api/rooms`, {\r\n        method: 'post',\r\n        body: JSON.stringify(data),\r\n        headers: { 'Content-Type': 'application/json' }\r\n      });\r\n      setLoading(false);\r\n\r\n      if (res.status >= 400) {\r\n        setError(new Error(`Something went wrong. Try again`));\r\n        return;\r\n      }\r\n\r\n      const room = await res.json();\r\n      if (room) {\r\n        setError(null);\r\n        setRoomId(room.id);\r\n        setLink(`${window.location.origin}/#/room-lobby/${room.id}`);\r\n      }\r\n    } catch (err) {\r\n      setError(err);\r\n    }\r\n  };\r\n\r\n  const createRoomJSX =\r\n    <Box display='flex' flexDirection='column' alignItems='center' width={'100%'} borderRadius='5px' bgcolor='white'>\r\n      <Typography variant='h4' className={classes.titleStyle}>Create a new room</Typography>\r\n      <TextField\r\n        required\r\n        label='Room name'\r\n        variant='outlined'\r\n        value={name}\r\n        onChange={handleChangeTexfield}\r\n        className={classes.textfield}\r\n        onKeyPress={handleKeyPress}\r\n        autoFocus\r\n      />\r\n      <div className={classes.alignButton}>\r\n        <div className={classes.btnCreateWrapper}>\r\n          <Button\r\n            size='large'\r\n            color='secondary'\r\n            variant='contained'\r\n            disabled={loading}\r\n            className={classes.btnCreate}\r\n            onClick={createRoom}\r\n          >\r\n            Create\r\n          </Button>\r\n          {loading && <CircularProgress size={24} className={classes.btnCreateProgress}/>}\r\n        </div>\r\n      </div>\r\n    </Box>;\r\n\r\n  const shareRoomJSX =\r\n    <Box\r\n      display='flex'\r\n      flexDirection='column'\r\n      alignItems='center'\r\n      width={'100%'}\r\n      borderRadius='5px'\r\n      bgcolor='white'\r\n      onKeyPress={handleKeyPress}\r\n    >\r\n      <Typography variant='h4' className={classes.titleStyle}>Room was created</Typography>\r\n      <div className={classes.copyLink}>\r\n        <TextField variant='outlined' value={link} onChange={handleChangeTexfield} className={classes.textfieldLink} autoFocus/>\r\n        <Button size='large' color='secondary' variant='contained' className={classes.myButton} onClick={() => {\r\n          navigator.clipboard.writeText(link);\r\n        }}>\r\n          copy\r\n        </Button>\r\n      </div>\r\n      <Typography variant='h6' align='center' className={classes.subtitle}>\r\n        Share the link to let people join this room\r\n      </Typography>\r\n\r\n      <Link to={`/room-lobby/${roomId}`} style={{ textDecoration: 'none', width: '80%' }}>\r\n        <Button\r\n          size='large'\r\n          color='secondary'\r\n          variant='contained'\r\n          className={classes.nextButton}\r\n          to={`/room-lobby/${roomId}`}\r\n        >\r\n          next\r\n        </Button>\r\n      </Link>\r\n    </Box>;\r\n\r\n  return (\r\n    <div>\r\n      {/* Header */}\r\n      <Box\r\n        display='flex'\r\n        height={63}\r\n        bgcolor='#2E7D32'\r\n        alignItems='center'\r\n        paddingLeft='36px'\r\n      >\r\n        <Link to='/' style={{ textDecoration: 'none', color: 'white' }}>\r\n          <ArrowBackIosIcon/>\r\n        </Link>\r\n      </Box>\r\n\r\n      {/* Body */}\r\n      <Grid container className={classes.containerStyle}>\r\n        <Grid item xs={11} md={6} lg={6}>\r\n          {roomId ? shareRoomJSX : createRoomJSX}\r\n          {error && <Box color={'red'} textAlign={'center'}>{error.message}</Box>}\r\n        </Grid>\r\n      </Grid>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RoomCreateForm;\r\n","import React from 'react';\r\nimport {HashRouter as Router, Route, Switch} from 'react-router-dom';\r\nimport {CssBaseline} from '@material-ui/core';\r\nimport RoomLobby from '../RoomLobby/RoomLobby';\r\nimport Room from '../Room/Room';\r\nimport Home from '../Home/Home';\r\nimport RoomCreateForm from '../RoomCreateForm/RoomCreateForm';\r\nimport {ThemeProvider} from '@material-ui/core/styles';\r\nimport theme from '../../style/theme/MainTheme';\r\n\r\nconst App = () => {\r\n  return (\r\n    <CssBaseline>\r\n      <ThemeProvider theme={theme}>\r\n        <Router>\r\n          <Switch>\r\n            <Route exact path='/' component={Home}/>\r\n            <Route exact path='/create-room' component={RoomCreateForm}/>\r\n            <Route exact path='/room-lobby/:roomId' component={RoomLobby}/>\r\n            <Route path='/rooms/:roomId' component={Room}/>\r\n          </Switch>\r\n        </Router>\r\n      </ThemeProvider>\r\n    </CssBaseline>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport './index.scss';\r\nimport ReactDOM from 'react-dom';\r\nimport {Provider} from 'react-redux';\r\nimport store from './store';\r\nimport App from './components/App/App';\r\n// eslint-disable-next-line\r\nimport adapter from 'webrtc-adapter'; // insulates app from browser webrtc implementation differences\r\n\r\nReactDOM.render(\r\n  <>\r\n    <Provider store={store}>\r\n      <App/>\r\n    </Provider>\r\n  </>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}